# Гайд по техническому управлению клубом

## Как получить доступ в джанго админку
1. В консоли сервера выполнить команду docker exec -it club_app python3 manage.py createsuperuser
1. Открыть в браузере https://<ваш домен>/godmode/admin
1. Залогиниться под созданным логином

## Как стать суперпользователем в клубе
1. Начать регистрацию в клубе как обычно (заполнить анкету)
1. В консоли сервера выполнить команду `docker exec -it club_app python3 manage.py shell`
1. `user = User.objects.get(slug="<ваш slug>")`
1. `user.moderation_status = "approved"`
1. `user.roles = ["god"]`
1. `user.save()`
1. Проверить, что открывается /godmode

## Как создать комнату
1. Открыть /godmode/admin/rooms/room/
1. Нажать справа сверху кнопку “Add room”
1. slug - то что будет в урле комнаты
1. title - название
1. subtitle - подзаголовок на странице комнаты
1. image - урл на картинку с иконкой
1. description - описание на странице комнаты
1. color - цвет плашки комнаты, в #RGB
1. Нажать внизу кнопку “Save”

## Как добавлять клубные теги
1. Открыть в коде файл `common/data/tags.py`
1. Добавить нужный тег
1. Выкатить изменение на сервер
1. Запустить в консоли сервера команду `docker exec -it club_app python3 manage.py update_tags`

## Как добавлять коллекционные теги
Тег добавляется автором поста в момент создания этого поста. Разверните блок “Прикрепить коллекционный тег” на странице редактирования.

## Как редактировать лейблы, которые выдаются постам
1. Открыть в коде файл `common/data/labels.py`
1. Добавить нужную метку
1. Выкатить изменение на сервер

## Как назначить посту лейбл
1. Зайти под куратором или выше
1. Перейти на страницу поста
1. Нажать на ссылку с инструментами (самая правая)
1. Выбрать пункт “Выдать лейбл”

## Как редактировать ачивки, которые выдаются участникам
1. Открыть в коде файл `common/data/achievements.py`
1. Добавить нужную ачивку
1. Выкатить изменение на сервер
1. Запустить в консоли сервера команду `docker exec -it club_app python3 manage.py update_achievements`

## Как выдать ачивку участнику
1. Зайти под модератором или выше
1. Перейти на страницу участника
1. Перейти по ссылке “админка”
1. Долистать до блока “Ачивки”
1. Выбрать ачивку и сохранить

## Как одобрять новых пользователей
1. Создать чат для модерации
1. Добавить туда бота вашего клуба
1. В настройках CI проекта прописать TELEGRAM_ADMIN_CHAT_ID ид чата для модерации
1. Выполнить деплой клуба
1. В чат будут попадать новые анкеты с возможностью пропустить или заблокировать их

## Как выдать новую роль участнику
1. Зайти в профиль участника в клубе /user/username
1. Нажать на ссылку “Админка”
1. Пролистать до блока “Роли”
1. Действие - добавить роль
1. Роль
   1. Куратор - может курировать посты (дать лейбл, поднять на главной, скрыть с главной и тд)
   1. Модератор - может модерировать посты (все вышеперечисленное + закрыть комменты) и участников
   1. Банк - может добавлять дни участникам
   1. Бог - может все

## Как сделать дамп базы
1. Запустить в консоли сервера команду `docker exec club_postgres pg_dump --clean --if-exists --no-owner --no-privileges "host=localhost port=5432 dbname=vas3k_club user=vas3k password=vas3k" | gzip > dump.sql.gz`

## Как залить дамп базы
1. `docker cp dump.sql.gz club_postgres:/tmp/`
1. `docker exec -it club_postgres bash`
1. `cd /tmp`
1. `gunzip dump.sql.gz`
1. `psql -d vas3k_club -h localhost -U vas3k --password vas3k -w < dump.sql` 

## У меня не получается, что делать?
Все вопросы можете смело адресовать [автору этого гайда](https://vas3k.club/user/glader/)
